datasource db {
  provider = "mysql"
}

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

model User {
  id          String @id @default(cuid())
  name        String
  email       String @unique
  password    String
  phoneNumber BigInt?
  city        String?
  role          Role      @default(STUDENT)
  requestedRole String?   // For tracking what role the user signed up for (TEACHER | STUDENT)

  examsCreated Exam[]   @relation("TeacherExams")
  results      Result[]
  assignedExams ExamAssignment[]
}

model Exam {
  id          String   @id @default(cuid())
  title       String
  description String
  timeLimit   Int // in minutes
  teacherId   String
  teacher     User     @relation("TeacherExams", fields: [teacherId], references: [id])
  questions   Question[]
  results     Result[]
  assignments ExamAssignment[]
  createdAt   DateTime @default(now())
}

model ExamAssignment {
  id        String   @id @default(cuid())
  examId    String
  exam      Exam     @relation(fields: [examId], references: [id], onDelete: Cascade)
  studentId String
  student   User     @relation(fields: [studentId], references: [id], onDelete: Cascade)
  assignedAt DateTime @default(now())

  @@unique([examId, studentId])
}

model Question {
  id               String @id @default(cuid())
  examId           String
  exam             Exam   @relation(fields: [examId], references: [id], onDelete: Cascade)
  text             String
  options          String // JSON string
  correctAnswerIndex Int
}

model Result {
  id             String   @id @default(cuid())
  studentId      String
  student        User     @relation(fields: [studentId], references: [id])
  examId         String
  exam           Exam     @relation(fields: [examId], references: [id])
  score          Int
  completionTime Int // Time taken in seconds or minutes
  teacherApproval Boolean @default(false)
  adminApproval   Boolean @default(false)
  responses       Json?    // Added to store student answers for review
  createdAt      DateTime @default(now())
}

enum Role {
  ADMIN
  TEACHER
  STUDENT
  NONE
}
